/* Create a View called “forestation” by joining all three tables - forest_area, land_area and regions in the workspace. */

DROP VIEW IF EXISTS forestation;
CREATE VIEW forestation AS
 SELECT
  fa.country_code AS code,
  fa.country_name AS country,
  fa.year AS "year",
  fa.forest_area_sqkm AS forest_area_sqkm,
  la.total_area_sq_mi AS total_area_sq_mi,
  r.region AS region,
  r.income_group AS income_group,
  100.0*(fa.forest_area_sqkm / (la.total_area_sq_mi * 2.59)) AS percentage
 FROM forest_area fa, land_area la, regions r
 WHERE (fa.country_code = la.country_code AND fa.year = la.year AND r.country_code = la.country_code);
 
 
 
 /*  What was the total forest area (in sq km) of the world in 1990? */
 
SELECT *
FROM forest_area
WHERE country_name = 'World'
AND year = 1990 


/*  What was the total forest area (in sq km) of the world in 2016 */

SELECT *
FROM forest_area
WHERE country_name = 'World'
AND year = 1990 


/* 1st and 2nd question in the same query */

SELECT *
FROM forest_area
WHERE country_name = 'World'
AND (year = 2016 OR year = 1990);


/* If you compare the amount of forest area lost between 1990 and 2016, to which country's total area in 2016 is it closest to? */

WITH difference as 
 (SELECT  
   current.forest_area_sqkm - prev.forest_area_sqkm
  AS difference_num
  FROM forest_area AS current
  JOIN forest_area AS prev
  ON  (current.year = '2016' AND prev.year = '1990'
  AND current.country_name = 'World' AND prev.country_name = 'World') )
SELECT 
fa.country_name,
fa.forest_area_sqkm,
ABS(difference.difference_num)
FROM forest_area as fa, difference
WHERE year = 2016
AND ABS(difference.difference_num) >= fa.forest_area_sqkm
ORDER BY fa.forest_area_sqkm desc
LIMIT 1

